# Paper: 
# Data: https://osf.io/bd6cu/
library(haven)
library(dplyr)
library(tidyr)

# Remove participants whose responses are all NAs
remove_na <- function(df) {
  df <- df[!(rowSums(is.na(df[, -which(names(df) == "id")])) == (ncol(df) - 1)), ]
  return(df)
}

df <- read.csv("PHQ_FINAL_Manuscript.csv")
df[df == 99] <- NA
df <- df |>
  rename(id=ID) |>
  select(-classification, -female, -age, -filipino, -genstat, -qol)

# ------ Process PHQ-8 Dataset ------
phq8_df <- df |>
  select(id, starts_with("phq"))
phq8_df <- remove_na(phq8_df)
phq8_df <- pivot_longer(phq8_df, cols=-id, names_to="item", values_to = "resp")

save(phq8_df, file="CVE-PHQ8_Carter_2024_PHQ8.Rdata")
write.csv(phq8_df, "CVE-PHQ8_Carter_2024_PHQ8.csv", row.names=FALSE)
# ------ Process SPSS-10 Dataset ------
stress_df <- df |>
  select(id, starts_with("stress"))
stress_df <- remove_na(stress_df)
stress_df <- pivot_longer(stress_df, cols=-id, names_to="item", values_to = "resp")

save(stress_df, file="CVE-PHQ8_Carter_2024_SPSS10.Rdata")
write.csv(stress_df, "CVE-PHQ8_Carter_2024_SPSS10.csv", row.names=FALSE)
# ------ Process GAD-7 Dataset ------
gad_df <- df |>
  select(id, starts_with("gad"))
gad_df <- remove_na(gad_df)
gad_df <- pivot_longer(gad_df, cols=-id, names_to="item", values_to = "resp")

save(gad_df, file="CVE-PHQ8_Carter_2024_GAD7.Rdata")
write.csv(gad_df, "CVE-PHQ8_Carter_2024_GAD7.csv", row.names=FALSE)
# ------ Process CESD Dataset ------
cesd_df <- df |>
  select(id, starts_with("cesd"))
cesd_df <- remove_na(cesd_df)
cesd_df <- pivot_longer(cesd_df, cols=-id, names_to="item", values_to = "resp")

save(cesd_df, file="CVE-PHQ8_Carter_2024_CESD.Rdata")
write.csv(cesd_df, "CVE-PHQ8_Carter_2024_CESD.csv", row.names=FALSE)
